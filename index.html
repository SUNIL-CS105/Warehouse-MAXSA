<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=0.9" />
  <title>MAXSA Warehouse Map with Resizable Pallets</title>
  <style>
    body { font-family: Arial; background: #f5f5f5; margin:0; padding:1rem; }
    h2 { margin-top: 0; }
    .grid-stack {
      position: relative;
      width: 1700px;
      height: 1350px;
      background: #ADD8E6;
      border: 2px solid #000000;
      user-select: none;
    }
    .label-cell {
      position: absolute;
      border: 1px solid #000000;
      text-align: center;
      padding: 5px;
      font-size: 12px;
      background-color: #FFFFFF;
      box-sizing: border-box;
    }
    .office-zone, .restroom-zone, .drop-zone {
      font-weight: bold;
    }
    .office-zone {
      background-color: #FFFFFF;
    }
    .restroom-zone {
      background-color: #FFFFFF;
    }
    .drop-zone {
      border: 2px dashed white;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      cursor: default;
    }
    .drop-zone#SHIPPED {
      background-color: #e74c3c;
    }
    .drop-zone#TO-8412-OFFICE {
      background-color: #2980b9;
    }
    .pallet {
      position: absolute;
      background: orange;
      color: black;
      font-weight: bold;
      border: 2px solid #000000;
      text-align: center;
      cursor: grab;
      user-select: none;
      box-sizing: border-box;
      padding: 4px 2px 10px 2px;
      font-size: 12px;
      white-space: pre-line;
    }
    .pallet.dragging {
      opacity: 0.6;
      cursor: grabbing;
      z-index: 1000;
    }
    .split-arrow {
      position: absolute;
      top: 2px;
      right: 4px;
      background: black;
      color: white;
      font-weight: bold;
      font-size: 14px;
      width: 18px;
      height: 18px;
      line-height: 18px;
      border-radius: 3px;
      cursor: pointer;
      user-select: none;
      z-index: 10;
    }
    #add-product-panel {
      position: absolute;
      top: 650px;
      left: 1000px;
      background: #27ae60;
      padding: 10px;
      border-radius: 6px;
      color: white;
      font-weight: bold;
      width: 200px;
      box-sizing: border-box;
    }
    #add-product-panel input {
      width: calc(100% - 12px);
      margin-bottom: 6px;
      padding: 5px;
      border: none;
      border-radius: 3px;
      font-size: 14px;
    }
    #add-product-panel button {
      width: 100%;
      padding: 6px;
      font-weight: bold;
      font-size: 14px;
      background: #2ecc71;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      color: white;
    }
    #add-product-panel button:hover {
      background: #27ae60;
    }
    #inventory-summary-panel {
      position: absolute;
      top: 80px;
      left: 1450px;
      background: #3498db;
      padding: 10px;
      border-radius: 6px;
      color: white;
      font-weight: bold;
      width: 220px;
      box-sizing: border-box;
      font-size: 14px;
      cursor: pointer;
      text-align: center;
      user-select: none;
    }
    #inventory-summary-output {
      max-height: 120px;
      overflow-y: auto;
      margin-top: 6px;
      font-weight: normal;
      font-size: 13px;
      background: rgba(255 255 255 / 0.2);
      padding: 6px;
      border-radius: 4px;
      text-align: left;
      white-space: nowrap;
    }
  </style>
</head>
<body>
  <h2>MAXSA Warehouse Map</h2>

  <div class="grid-stack"></div>

  <div id="add-product-panel">
    <input type="text" id="new-item" placeholder="Item #" />
    <input type="number" id="new-qty" placeholder="Quantity" min="1" />
    <button id="add-product-btn">âž• Add New Product</button>
  </div>

  <div id="inventory-summary-panel" title="Show total quantities of all products (excluding shipped and To 8412 Office)">
    ðŸ“Š Show Inventory Summary
    <div id="inventory-summary-output" style="display:none;"></div>
  </div>

  <script>
    // --- Constants for locations ---
    const CELL_WIDTH = 80;
    const CELL_HEIGHT = 50;

    // Location definitions as per your dimension requirements
    const locations = {
      gridLabels: {
        rows: ['X','W','V','U','T','S','R','Q','P','O','N','M','L','K','J','I','H','G','F','E','D','C','B','A'],
        cols: 11
      },
      offices: {
        count: 30,
        startLeft: 980,
        startTop: 0,
        cols: 6,
        cellWidth: 80,
        cellHeight: 50
      },
      restroomsShelvesTemp: [
        { name: 'Restroom1', left: 980, top: 300 },
        { name: 'Restroom2', left: 1060, top: 300 },
        { name: 'Shelf1', left: 1220, top: 300 },
        { name: 'Shelf2', left: 1300, top: 300 },
        { name: 'Shelf3', left: 1380, top: 300 },
        { name: 'Shelf4', left: 1220, top: 350 },
        { name: 'Shelf5', left: 1300, top: 350 },
        { name: 'Shelf6', left: 1380, top: 350 },
        { name: 'T_NewProduct', left: 1300, top: 650},
        { name: 'Temporary1', left: 980, top: 820 },
        { name: 'Temporary2', left: 1060, top: 870 },
        { name: 'Temporary3', left: 1140, top: 9200 },
        { name: 'Temporary4', left: 1220, top: 970 },
        { name: 'Temporary5', left: 1300, top: 1020 },
        { name: 'Temporary6', left: 1380, top: 1070 },
        { name: 'Temporary7', left: 980, top: 820 },
        { name: 'Temporary8', left: 1060, top: 870 },
        { name: 'Temporary9', left: 1140, top: 920 },
        { name: 'Temporary10', left: 1220, top: 970 },
        { name: 'Temporary11', left: 1300, top: 1020 },
        { name: 'Temporary12', left: 1380, top: 1070 }
      ],
      dropZones: [
        { id: "SHIPPED", name: "SHIPPED", left: 980, top: 450, width: 160, height: 80, color: '#e74c3c' },
        { id: "TO-8412-OFFICE", name: "TO 8412 OFFICE", left: 1300, top: 450, width: 160, height: 80, color: '#2980b9' }
      ]
    };

    // --- Variables to hold pallets ---
    let pallets = []; // array of pallet objects

    // Map location pallets: key = location name, value = array of pallets in that location
    let palletsByLocation = {};

    // --- Create grid labels ---
    function createGridLabels() {
      const container = document.querySelector('.grid-stack');
      // Main grid A1-X11 on left side
      const rows = locations.gridLabels.rows;
      for(let r = 0; r < rows.length; r++) {
        for(let c = 1; c <= locations.gridLabels.cols; c++) {
          const div = document.createElement('div');
          div.className = 'label-cell';
          div.style.left = `${c * CELL_WIDTH}px`;
          div.style.top = `${r * CELL_HEIGHT}px`;
          div.style.width = `${CELL_WIDTH}px`;
          div.style.height = `${CELL_HEIGHT}px`;
          div.innerText = `${rows[r]}${c}`;
          div.dataset.location = `${rows[r]}${c}`;
          container.appendChild(div);
        }
      }
      // Offices top right
      const off = locations.offices;
      for(let i = 1; i <= off.count; i++) {
        const col = i % off.cols;
        const row = Math.floor((i - 1) / off.cols);
        const div = document.createElement('div');
        div.className = 'label-cell office-zone';
        div.style.left = `${off.startLeft + col * off.cellWidth}px`;
        div.style.top = `${off.startTop + row * off.cellHeight}px`;
        div.style.width = `${off.cellWidth}px`;
        div.style.height = `${off.cellHeight}px`;
        div.innerText = `Office${i}`;
        div.dataset.location = `Office${i}`;
        container.appendChild(div);
      }
      // Restrooms, shelves, temporary middle right
      locations.restroomsShelvesTemp.forEach(item => {
        const div = document.createElement('div');
        div.className = 'label-cell restroom-zone';
        div.style.left = `${item.left}px`;
        div.style.top = `${item.top}px`;
        div.style.width = `${CELL_WIDTH}px`;
        div.style.height = `${CELL_HEIGHT}px`;
        div.innerText = item.name;
        div.dataset.location = item.name;
        container.appendChild(div);
      });
      // Drop zones bottom right
      locations.dropZones.forEach(zone => {
        const div = document.createElement('div');
        div.className = 'label-cell drop-zone';
        div.id = zone.id;
        div.style.left = `${zone.left}px`;
        div.style.top = `${zone.top}px`;
        div.style.width = `${zone.width}px`;
        div.style.height = `${zone.height}px`;
        div.style.backgroundColor = zone.color;
        div.innerText = zone.name;
        div.dataset.location = zone.name;
        container.appendChild(div);

        // Make drop zones droppable
        makeDropZoneDroppable(div);
      });
    }

    // --- Helper: Find location element under coordinates ---
    function findLocationUnder(x, y) {
      const locElems = document.querySelectorAll('.label-cell');
      for (const el of locElems) {
        const rect = el.getBoundingClientRect();
        // Because pallets are positioned relative to container, we use container top/left later
        // But since pallets are absolutely positioned inside container, and mouse events relative to container,
        // We'll compute relative positions later in drag/drop
      }
      // Instead: We'll find closest location by minimal distance between centers, within threshold.
      const container = document.querySelector('.grid-stack');
      const containerRect = container.getBoundingClientRect();

      // Convert page coords to container coords:
      const relX = x - containerRect.left;
      const relY = y - containerRect.top;

      let found = null;
      let minDist = 99999;

      document.querySelectorAll('.label-cell').forEach(el => {
        const elX = parseFloat(el.style.left) + el.offsetWidth/2;
        const elY = parseFloat(el.style.top) + el.offsetHeight/2;
        const dx = relX - elX;
        const dy = relY - elY;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if (dist < minDist && dist < 60) { // threshold 60px to snap
          minDist = dist;
          found = el.dataset.location;
        }
      });
      return found;
    }

    // --- Pallet class for easier management ---
    class Pallet {
      constructor(id, itemId, quantity, location) {
        this.id = id;
        this.itemId = itemId;
        this.quantity = quantity;
        this.location = location || "Temporary1";

        this.el = document.createElement('div');
        this.el.className = 'pallet';
        this.el.setAttribute('draggable', 'true');
        this.el.dataset.id = id;
        this.el.dataset.itemId = itemId;
        this.el.dataset.quantity = quantity;
        this.el.dataset.location = this.location;

        this.splitArrow = document.createElement('div');
        this.splitArrow.className = 'split-arrow';
        this.splitArrow.innerHTML = 'â—®';
        this.el.appendChild(this.splitArrow);

        this.updateText();

        this.el.appendChild(document.createElement('br'));

        this.addEventListeners();
      }

      updateText() {
        this.el.innerText = `${this.itemId}\nQty: ${this.quantity}`;
        this.el.appendChild(this.splitArrow);
      }

      addEventListeners() {
        this.el.addEventListener('dragstart', e => {
          e.dataTransfer.setData('text/plain', this.id);
          e.dataTransfer.effectAllowed = "move";
          this.el.classList.add('dragging');
          // Store original pos in case revert needed
          this.dragStartPos = { left: this.el.style.left, top: this.el.style.top };
        });

        this.el.addEventListener('dragend', e => {
          this.el.classList.remove('dragging');
          // After drop, snap to nearest location and resize container pallets
          const dropX = e.pageX;
          const dropY = e.pageY;
          const nearestLocation = findLocationUnder(dropX, dropY);

          if (nearestLocation) {
            this.moveToLocation(nearestLocation);
          } else {
            // revert to original position if no snap location found
            this.el.style.left = this.dragStartPos.left;
            this.el.style.top = this.dragStartPos.top;
          }
          adjustPalletSizesAtLocation(this.location);
          adjustPalletSizesAtLocation(this.prevLocation);
        });

        this.splitArrow.addEventListener('click', e => {
          e.stopPropagation();
          const splitQty = prompt(`Enter quantity to split from "${this.itemId}" (max ${this.quantity -1}):`, Math.floor(this.quantity/2));
          const num = parseInt(splitQty);
          if (!isNaN(num) && num > 0 && num < this.quantity) {
            this.quantity -= num;
            this.updateText();
            // Add new pallet with split qty at same location
            const newPallet = createNewPallet(this.itemId, num, this.location);
            pallets.push(newPallet);
            adjustPalletSizesAtLocation(this.location);
          }
        });
      }

      moveToLocation(newLoc) {
        if(newLoc === this.location) return; // no change
        // Remove from old location array
        if (palletsByLocation[this.location]) {
          palletsByLocation[this.location] = palletsByLocation[this.location].filter(p => p !== this);
          if(palletsByLocation[this.location].length === 0) delete palletsByLocation[this.location];
        }
        // Add to new location
        if (!palletsByLocation[newLoc]) palletsByLocation[newLoc] = [];
        palletsByLocation[newLoc].push(this);

        // Update location property & dataset
        this.prevLocation = this.location;
        this.location = newLoc;
        this.el.dataset.location = newLoc;

        // Position pallet inside location box, stacking pallets vertically
        positionPalletInLocation(this);

        // Special handling: If dropped into SHIPPED or TO 8412 OFFICE, remove pallet and update quantities
        if (newLoc === 'SHIPPED' || newLoc === 'TO 8412 OFFICE') {
          // Remove pallet completely
          this.remove();
          pallets = pallets.filter(p => p !== this);
          // Update summary and pallet sizes
          updateInventorySummary();
          adjustPalletSizesAtLocation(newLoc);
          adjustPalletSizesAtLocation(this.prevLocation);
        }
      }

      remove() {
        if(this.el.parentNode) this.el.parentNode.removeChild(this.el);
      }
    }

    // --- Helper to create new pallet and add to DOM/pallet list ---
    function createNewPallet(itemId, quantity, location = "Temporary1") {
      const id = 'pallet-' + Date.now() + '-' + Math.floor(Math.random()*1000);
      const pallet = new Pallet(id, itemId, quantity, location);

      document.querySelector('.grid-stack').appendChild(pallet.el);

      // Add to pallets array
      pallets.push(pallet);

      // Add to location mapping
      if(!palletsByLocation[location]) palletsByLocation[location] = [];
      palletsByLocation[location].push(pallet);

      // Position the pallet
      positionPalletInLocation(pallet);
      adjustPalletSizesAtLocation(location);

      return pallet;
    }

    // --- Position pallet stacked inside a location ---
    function positionPalletInLocation(pallet) {
      const location = pallet.location;
      // Find the location box element
      let locEl = null;
      // For drop zones like SHIPPED & TO 8412 OFFICE, they have IDs
      if(location === "SHIPPED" || location === "TO 8412 OFFICE") {
        locEl = document.getElementById(location.replace(/\s/g, '-'));
      } else {
        // Otherwise find label-cell by dataset location
        locEl = Array.from(document.querySelectorAll('.label-cell'))
          .find(el => el.dataset.location === location);
      }
      if(!locEl) return; // no location found

      const left = parseInt(locEl.style.left);
      const top = parseInt(locEl.style.top);
      const width = parseInt(locEl.style.width);
      const height = parseInt(locEl.style.height);

      // Calculate vertical stacking based on how many pallets are in this location
      const stack = palletsByLocation[location] || [];
      const idx = stack.indexOf(pallet);
      const total = stack.length;

      // Size pallets evenly inside location width, full height / total count
      const palletWidth = width;
      const palletHeight = Math.floor(height / total);

      // Position pallet: left + 0, top + height_per_pallet * idx
      pallet.el.style.left = left + 'px';
      pallet.el.style.top = (top + palletHeight * idx) + 'px';
      pallet.el.style.width = palletWidth + 'px';
      pallet.el.style.height = palletHeight + 'px';
    }

    // --- Adjust all pallets sizes and positions at a location ---
    function adjustPalletSizesAtLocation(location) {
      if(!location) return;
      const stack = pallets
ByLocation[location];
if (!stack) return;
stack.forEach(p => positionPalletInLocation(p));
}
// --- Drop zone interaction ---
function makeDropZoneDroppable(zoneEl) {
  zoneEl.addEventListener('dragover', e => {
    e.preventDefault();
    zoneEl.style.outline = '2px dashed #fff';
  });
  zoneEl.addEventListener('dragleave', e => {
    zoneEl.style.outline = '';
  });
  zoneEl.addEventListener('drop', e => {
    e.preventDefault();
    const id = e.dataTransfer.getData('text/plain');
    const pallet = pallets.find(p => p.id === id);
    if(pallet) {
      pallet.moveToLocation(zoneEl.dataset.location);
    }
    zoneEl.style.outline = '';
  });
}

// --- Add Product Form Submit ---
document.getElementById('add-product-btn').addEventListener('click', () => {
  const itemId = document.getElementById('new-item').value.trim();
  const qty = parseInt(document.getElementById('new-qty').value);
  if(!itemId || isNaN(qty) || qty < 1) {
    alert("Enter valid Item ID and Quantity");
    return;
  }
  createNewPallet(itemId, qty, 'Temporary1');
  document.getElementById('new-item').value = '';
  document.getElementById('new-qty').value = '';
});

// --- Inventory Summary Button ---
document.getElementById('inventory-summary-panel').addEventListener('click', () => {
  updateInventorySummary();
  const output = document.getElementById('inventory-summary-output');
  output.style.display = output.style.display === 'none' ? 'block' : 'none';
});

function updateInventorySummary() {
  const summary = {};
  pallets.forEach(p => {
    if(p.location !== 'SHIPPED' && p.location !== 'TO 8412 OFFICE') {
      summary[p.itemId] = (summary[p.itemId] || 0) + p.quantity;
    }
  });
  const out = document.getElementById('inventory-summary-output');
  out.innerHTML = '';
  for(let key in summary) {
    out.innerHTML += `${key}: ${summary[key]}<br>`;
  }
}

// --- Initialization ---
window.onload = function () {
  createGridLabels();


};
  </script>
  </body>
  </html>
