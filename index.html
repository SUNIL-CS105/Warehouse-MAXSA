<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MAXSA Warehouse</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: Arial;
      background: #f5f5f5;
      margin: 0;
      padding: 1rem;
    }

    .grid-stack {
      position: relative;
      width: 1700px;
      height: 1000px;
      background: white;
      border: 2px solid #ccc;
    }

    .label-cell {
      position: absolute;
      border: 1px solid #ccc;
      text-align: center;
      padding: 5px;
      font-size: 12px;
      background-color: #f9f9f9;
      box-sizing: border-box;
      width: 120px;
      height: 60px;
    }

    .pallet {
      position: absolute;
      background: orange;
      color: black;
      font-weight: bold;
      border: 2px solid #555;
      text-align: center;
      cursor: move;
      user-select: none;
      box-sizing: border-box;
      padding-top: 4px;
      overflow: hidden;
    }

    .pallet span.item {
      display: block;
      font-size: 14px;
    }
    .pallet span.qty {
      display: block;
      font-size: 11px;
      margin-top: 2px;
    }

    .drop-zone {
      border: 2px dashed white;
    }

    .form-panel {
      position: absolute;
      top: 510px;
      left: 1000px;
      background: #e4ffe4;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .form-panel input {
      font-size: 14px;
      padding: 6px;
      margin-right: 10px;
    }

    .btn {
      font-size: 14px;
      padding: 6px 10px;
      background: #444;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }

    .btn:hover {
      background: black;
    }

    .split-btn {
      font-size: 10px;
      position: absolute;
      right: 2px;
      bottom: 2px;
      cursor: pointer;
    }

    .total-btn {
      position: absolute;
      top: 510px;
      left: 1320px;
    }
  </style>
</head>
<body>
  <h2>MAXSA Warehouse Map</h2>

  <div class="form-panel">
    <input type="text" id="item-id" placeholder="Item #" />
    <input type="number" id="quantity" placeholder="Quantity" />
    <button class="btn" onclick="addNewPallet()">âž• Add Product</button>
  </div>

  <button class="btn total-btn" onclick="showTotalQuantities()">ðŸ“Š Show Total Quantities</button>

  <div class="grid-stack" id="warehouse-grid"></div>

  <script>
    const firebaseConfig = { /* same config */ };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function createLabel(x, y, text, className = '') {
      const div = document.createElement('div');
      div.className = `label-cell ${className}`;
      div.style.left = `${x}px`;
      div.style.top = `${y}px`;
      div.innerText = text;

      if (text !== 'SHIPPED' && text !== 'TO 8412 Office') {
        div.ondragover = e => e.preventDefault();
        div.ondrop = e => handleDropOnLabel(e, x, y);
      }

      document.getElementById('warehouse-grid').appendChild(div);
    }

    function handleDropOnLabel(e, x, y) {
      e.preventDefault();
      const id = e.dataTransfer.getData('text/plain');
      db.ref('pallets/' + id).update({ x, y });
    }

    function renderLabels() {
      const grid = document.getElementById('warehouse-grid');
      const rows = [...'XWVUTSRQPONMLKJIHGFEDCBA'];
      rows.forEach((row, i) => {
        for (let j = 1; j <= 11; j++) {
          createLabel(j * 120, i * 60, `${row}${j}`);
        }
      });

      for (let k = 1; k <= 30; k++) {
        const x = (k % 6) * 120 + 1000;
        const y = Math.floor((k - 1) / 6) * 60;
        createLabel(x, y, `Office${k}`, 'office-zone');
      }

      const extras = [
        { name: 'Restroom1', left: 1000, top: 300 },
        { name: 'Restroom2', left: 1120, top: 300 },
        { name: 'Shelf1', left: 1360, top: 300 },
        { name: 'Shelf2', left: 1480, top: 300 },
        { name: 'Shelf3', left: 1600, top: 300 },
        { name: 'Shelf4', left: 1360, top: 360 },
        { name: 'Shelf5', left: 1480, top: 360 },
        { name: 'Shelf6', left: 1600, top: 360 },
        { name: 'Temporary1', left: 1000, top: 360 },
        { name: 'Temporary2', left: 1120, top: 360 }
      ];
      extras.forEach(e => createLabel(e.left, e.top, e.name, 'restroom-zone'));

      const zones = [
        { name: 'SHIPPED', left: 1000, top: 440, color: 'red' },
        { name: 'TO 8412 Office', left: 1320, top: 440, color: 'blue' }
      ];
      zones.forEach(z => {
        const drop = document.createElement('div');
        drop.className = 'label-cell drop-zone';
        drop.style.left = `${z.left}px`;
        drop.style.top = `${z.top}px`;
        drop.style.backgroundColor = z.color;
        drop.style.color = 'white';
        drop.style.fontWeight = 'bold';
        drop.innerText = z.name;
        drop.style.width = '180px';
        drop.style.height = '90px';
        drop.id = z.name;
        drop.ondragover = e => e.preventDefault();
        drop.ondrop = e => handleDrop(e, z.name);
        grid.appendChild(drop);
      });
    }

    function handleDrop(e, zoneName) {
      e.preventDefault();
      const palletId = e.dataTransfer.getData('text/plain');
      if (!palletId || !zoneName) return;
      if (zoneName === 'SHIPPED' || zoneName === 'TO 8412 Office') {
        db.ref('pallets/' + palletId).remove();
      }
    }

    // The rest of the script remains unchanged: renderPallet, adjustAllPalletSizes, addNewPallet, loadPallets, showTotalQuantities
    // You can paste them back in or I can append if needed.

    renderLabels();
    loadPallets();
  </script>
</body>
</html>
