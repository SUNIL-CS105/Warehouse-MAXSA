<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MAXSA Warehouse</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: Arial;
      background: #f5f5f5;
      margin: 0;
      padding: 1rem;
    }

    .grid-stack {
      position: relative;
      width: 1700px;
      height: 1000px;
      background: white;
      border: 2px solid #ccc;
    }

    .label-cell {
      position: absolute;
      border: 1px solid #ccc;
      text-align: center;
      padding: 5px;
      font-size: 12px;
      background-color: #f9f9f9;
      box-sizing: border-box;
      width: 80px;
      height: 40px;
    }

    .pallet {
      position: absolute;
      background: orange;
      color: black;
      font-weight: bold;
      border: 2px solid #555;
      text-align: center;
      cursor: move;
      user-select: none;
      box-sizing: border-box;
      width: 80px;
      height: 40px;
    }

    .drop-zone {
      border: 2px dashed white;
    }

    .form-panel {
      margin-bottom: 1rem;
    }

    .form-panel input {
      font-size: 14px;
      padding: 6px;
      margin-right: 10px;
    }

    .btn {
      font-size: 14px;
      padding: 6px 10px;
      background: #444;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }

    .btn:hover {
      background: black;
    }
  </style>
</head>
<body>
  <h2>MAXSA Warehouse Map</h2>

  <div class="form-panel">
    <input type="text" id="item-id" placeholder="Item #" />
    <input type="number" id="quantity" placeholder="Quantity" />
    <button class="btn" onclick="addNewPallet()">âž• Add Product</button>
  </div>

  <div class="grid-stack" id="warehouse-grid"></div>

  <script>
    // Firebase setup
    const firebaseConfig = {
      apiKey: "AIzaSyDgTBFlnjtcbdvuf2l7YUnoHXK9-L4I5MI",
      authDomain: "warehouse-maxsa.firebaseapp.com",
      databaseURL: "https://warehouse-maxsa-default-rtdb.firebaseio.com",
      projectId: "warehouse-maxsa",
      storageBucket: "warehouse-maxsa.appspot.com",
      messagingSenderId: "978214247804",
      appId: "1:978214247804:web:aa785914ee177d74ba98f9"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function createLabel(x, y, text, className = '') {
      const div = document.createElement('div');
      div.className = `label-cell ${className}`;
      div.style.left = `${x}px`;
      div.style.top = `${y}px`;
      div.innerText = text;
      document.getElementById('warehouse-grid').appendChild(div);
    }

    function renderLabels() {
      const grid = document.getElementById('warehouse-grid');
      const rows = ['X','W','V','U','T','S','R','Q','P','O','N','M','L','K','J','I','H','G','F','E','D','C','B','A'];
      rows.forEach((row, i) => {
        for (let j = 1; j <= 11; j++) {
          createLabel(j * 80, i * 50, `${row}${j}`);
        }
      });

      // Offices
      for (let k = 1; k <= 30; k++) {
        const x = (k % 6) * 80 + 1000;
        const y = Math.floor((k - 1) / 6) * 50;
        createLabel(x, y, `Office${k}`, 'office-zone');
      }

      // Restrooms and Shelves
      const extras = [
        { name: 'Restroom1', left: 1000, top: 300 },
        { name: 'Restroom2', left: 1080, top: 300 },
        { name: 'Shelf1', left: 1240, top: 300 },
        { name: 'Shelf2', left: 1320, top: 300 },
        { name: 'Shelf3', left: 1400, top: 300 },
        { name: 'Shelf4', left: 1240, top: 350 },
        { name: 'Shelf5', left: 1320, top: 350 },
        { name: 'Shelf6', left: 1400, top: 350 },
        { name: 'Temporary1', left: 1000, top: 350 },
        { name: 'Temporary2', left: 1080, top: 350 }
      ];
      extras.forEach(e => createLabel(e.left, e.top, e.name, 'restroom-zone'));

      // SHIPPED and TO 8412
      const zones = [
        { name: 'SHIPPED', left: 1000, top: 420, color: 'red' },
        { name: 'TO 8412', left: 1320, top: 420, color: 'blue' }
      ];
      zones.forEach(z => {
        const drop = document.createElement('div');
        drop.className = 'label-cell drop-zone';
        drop.style.left = `${z.left}px`;
        drop.style.top = `${z.top}px`;
        drop.style.backgroundColor = z.color;
        drop.style.color = 'white';
        drop.style.fontWeight = 'bold';
        drop.innerText = z.name;
        drop.style.width = '160px';
        drop.style.height = '80px';
        drop.id = z.name;
        drop.ondragover = e => e.preventDefault();
        drop.ondrop = e => handleDrop(e, z.name);
        grid.appendChild(drop);
      });
    }

    function handleDrop(e, zoneName) {
      e.preventDefault();
      const palletId = e.dataTransfer.getData('text/plain');
      if (palletId && zoneName) {
        db.ref('pallets/' + palletId).remove();
      }
    }

    function renderPallet(id, data) {
      const pallet = document.createElement('div');
      pallet.className = 'pallet';
      pallet.style.left = `${data.x}px`;
      pallet.style.top = `${data.y}px`;
      pallet.innerText = `${data.item}\nQty: ${data.qty}`;
      pallet.id = id;
      pallet.draggable = true;

      pallet.addEventListener('dragstart', e => {
        e.dataTransfer.setData('text/plain', id);
        e.target.classList.add('dragging');
      });
      pallet.addEventListener('dragend', e => {
        const left = parseInt(pallet.style.left);
        const top = parseInt(pallet.style.top);
        db.ref('pallets/' + id).update({ x: left, y: top });
        pallet.classList.remove('dragging');
      });

      document.getElementById('warehouse-grid').appendChild(pallet);
    }

    function addNewPallet() {
      const item = document.getElementById('item-id').value.trim();
      const qty = parseInt(document.getElementById('quantity').value);
      if (!item || isNaN(qty) || qty <= 0) return alert('Enter valid item & quantity');
      const id = 'p' + Date.now();
      db.ref('pallets/' + id).set({ item, qty, x: 100, y: 700 });
      document.getElementById('item-id').value = '';
      document.getElementById('quantity').value = '';
    }

    function loadPallets() {
      db.ref('pallets').on('value', snapshot => {
        const all = document.querySelectorAll('.pallet');
        all.forEach(p => p.remove());

        const data = snapshot.val();
        for (let id in data) {
          renderPallet(id, data[id]);
        }
      });
    }

    renderLabels();
    loadPallets();
  </script>
</body>
</html>
